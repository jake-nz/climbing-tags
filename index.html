<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Climbing Labels</title>
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
  </head>

  <body>
    <div id="sections"></div>
    <script type="text/babel">
      const climbs = atob(location.search.substr(1))
        .split('&')
        .map((c) => decodeURIComponent(c).split('~'))

      const render = () =>
        climbs.map((c) => (
          <Climb
            grade={c[0]}
            date={c[1]}
            name={c[2]}
            setters={c[3]}
            notes={c[4]}
            key={c[2]}
          />
        ))

      const grades = {
        1: { color: '#357311' },
        2: { color: '#3a7e13' },
        3: { color: '#408b14' },
        4: { color: '#459716' },
        5: { color: '#4ba218' },
        6: { color: '#51af1a' },
        7: { color: '#59b519' },
        8: { color: '#64b818' },
        9: { color: '#71bc16' },
        10: { color: '#7cbf14', french: '1', uiaa: 'I', yds: '5' },
        11: { color: '#87c112', french: '2', uiaa: 'II', yds: '5.1/5.2' },
        12: { color: '#93c510', french: '3', uiaa: 'III', yds: '5.3/5.4' },
        13: { color: '#c6d208', french: '4a', uiaa: 'IV', yds: '5.5' },
        14: { color: '#ddd905', french: '4b', uiaa: 'IV+', yds: '5.6' },
        15: { color: '#f3df01', french: '4c', uiaa: 'V', yds: '5.7' },
        16: { color: '#fddb03', french: '5a', uiaa: 'V+', yds: '5.8' },
        17: { color: '#f9ce08', french: '5b', uiaa: 'VI-', yds: '5.9' },
        18: { color: '#f6c20e', french: '5c', uiaa: 'VI', yds: '5.10a' },
        19: { color: '#eea21c', french: '6a', uiaa: 'VI+', yds: '5.10b' },
        20: { color: '#ea9621', french: '6a+', uiaa: 'VII-', yds: '5.10c' },
        21: { color: '#e78a27', french: '6b', uiaa: 'VII', yds: '5.10d' },
        22: { color: '#e37b27', french: '6b+', uiaa: 'VII+', yds: '5.11a' },
        23: { color: '#e06a23', french: '6c', uiaa: 'VIII-', yds: '5.11b' },
        24: { color: '#dc5a1e', french: '6c+', uiaa: 'VIII', yds: '5.11c' },
        25: { color: '#d33314', french: '7a', uiaa: 'VIII+', yds: '5.11d' },
        26: { color: '#d02610', french: '7a+', uiaa: 'IX-', yds: '5.12a' },
        27: { color: '#ce1a0d', french: '7b+', uiaa: 'IX', yds: '5.12c' },
        28: { color: '#cb0d0a', french: '7c', uiaa: 'IX ', yds: 'IX+' },
        29: { color: '#c80a0f', french: '7c+', uiaa: 'IX+', yds: '5.13a' },
        30: { color: '#c40c1b', french: '8a+', uiaa: 'X-', yds: '5.13c' },
        31: { color: '#c10d26', french: '8b', uiaa: 'X', yds: '5.13d' },
        32: { color: '#be0f32', french: '8b+', uiaa: 'X+', yds: '5.14a' },
        33: { color: '#b41554', french: '8c', uiaa: 'X+', yds: 'XI-' },
        34: { color: '#b11761', french: '8c+', uiaa: 'XI-', yds: '5.14c' },
        35: { color: '#ad1a6f', french: '9a', uiaa: 'XI', yds: '5.14d' },
        36: { color: '#aa1b7b', french: '9a+', uiaa: 'XI+', yds: '5.15a' },
        37: { color: '#ae197f', french: '9b', uiaa: 'XII-', yds: '5.15b' },
        38: { color: '#b31783', french: '9b+', uiaa: 'XII', yds: '5.15c' },
        39: { color: '#b81588', french: '9c', uiaa: 'XII+', yds: '5.15d' },
      }

      const contentEditable = {
        contentEditable: true,
        suppressContentEditableWarning: true,
      }

      const Title = ({ name, done }) => {
        const [nameSize, setNameSize] = React.useState(11)
        const ref = React.useRef()
        React.useEffect(() => {
          const element = ref.current
          if (
            nameSize > 4 &&
            (element.scrollHeight > element.clientHeight ||
              element.scrollWidth > element.clientWidth)
          ) {
            setNameSize(nameSize - 0.5)
          } else {
            done()
          }
        }, [nameSize])

        return (
          <div
            ref={ref}
            className="name"
            style={{ fontSize: nameSize + 'vw' }}
            {...contentEditable}
          >
            {name || '\u00A0'}
          </div>
        )
      }

      const Climb = ({ name, grade, date, setters, notes }) => {
        const [sizing, setSizing] = React.useState(true)
        date = date ? new Date(date).toISOString().substr(0, 10) : ''

        const gradeData = grades[grade] || { color: '#ccc' }

        return (
          <div className="climb" style={{ opacity: sizing ? 0 : 1 }}>
            <div className="details">
              <Title name={name} done={() => setSizing(false)} />

              <div className="meta">
                <svg
                  viewBox="0 0 19 21"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M9.43558 21H9.11303C8.90398 20.9522 8.70462 20.8962 8.52359 20.791C7.21183 20.0305 5.90114 19.2798 4.59908 18.5194C3.29701 17.7687 1.99495 17.018 0.692879 16.2576C0.418098 16.0963 0.237064 15.869 0.113502 15.5841C0.0560317 15.4591 0.0265804 15.4031 0.0193966 15.0777L0 5.80443C0.00826138 5.78503 -4.38492e-06 5.80444 0.0179551 5.73727C0.0657275 5.43411 0.198992 5.17729 0.408041 4.95854C0.587636 4.76781 0.826134 4.65395 1.04524 4.53074C3.54413 3.0868 6.04302 1.64177 8.54335 0.206085C9.02753 -0.0686959 9.52142 -0.0686959 10.0067 0.206085C10.6058 0.548753 11.2035 0.900768 11.8026 1.24308C13.8173 2.40219 15.8223 3.56092 17.8374 4.72973C18.1869 4.93878 18.55 5.32061 18.5486 5.70781C18.5486 5.70925 18.5486 5.71463 18.55 5.7175C18.5486 8.76093 18.55 12.0694 18.55 15.2037C18.55 15.2109 18.55 15.2012 18.55 15.2109C18.4743 15.6951 18.1894 16.0683 17.7713 16.3054C15.5095 17.6074 13.248 18.9192 10.9761 20.2213C10.4808 20.5158 10.025 20.8865 9.43558 21V21ZM13.2563 3.18091C12.34 2.64068 12.4804 2.73336 11.1446 1.98265C12.789 2.36698 13.0487 3.77717 12.9811 4.52069C12.8479 5.03433 12.6866 5.53791 12.5911 6.06125C12.5437 6.34609 12.5731 6.43194 12.8102 6.58316C13.266 6.88775 13.7038 7.22037 14.0461 7.66648C14.4165 8.16181 14.6539 8.71172 14.7872 9.29253C14.8823 9.71063 14.8346 10.1374 14.7674 10.5555C14.7013 10.9653 14.5781 11.3636 14.4251 11.7537C14.1403 12.4764 13.7979 13.1793 13.5228 13.9103C13.1047 15.013 12.8957 16.1441 12.9811 17.3226C12.9912 17.5317 12.9995 17.731 13.0569 17.9314H13.0767C14.5023 17.1035 15.9362 16.2774 17.3618 15.4509C17.5429 15.3456 17.6183 15.1843 17.61 14.9753V6.02354C17.61 5.78504 17.5145 5.62377 17.3155 5.5099C16.6305 5.11982 15.9459 4.72147 15.2627 4.32169C14.5878 3.95101 14.0239 3.62127 13.2563 3.18091V3.18091ZM3.13573 10.6844C3.19464 10.6819 3.27618 10.6704 3.31389 10.6675C4.13213 10.5343 4.95001 10.4236 5.77794 10.4039C6.08074 10.3942 6.37563 10.4136 6.67987 10.4236C6.79373 10.4236 6.84258 10.4391 6.85263 10.5526C6.96075 10.9229 6.99703 11.1783 7.06025 11.3974C7.0994 11.6118 7.06708 11.6079 7.10802 11.8141C7.13029 11.9247 7.16837 12.1481 7.23841 12.3442C7.24272 12.3597 7.29049 12.2616 7.28474 12.2727C7.27361 12.2954 7.2693 12.2993 7.26355 12.3123C7.24954 12.3457 7.22153 12.3737 7.18776 12.406C7.12886 12.4383 7.12347 12.4523 7.07857 12.4649C6.95501 12.5001 7.00422 12.475 6.84689 12.4987C6.89897 12.5213 6.88748 12.6136 7.01966 12.6054C6.92124 12.601 6.77829 12.7135 6.6928 12.6908C6.92268 12.8945 6.91837 12.9645 7.10227 12.8313C7.05199 12.869 7.05055 12.8747 6.98446 12.9042C6.94674 12.9125 6.83863 13.0321 6.75422 13.0472C6.92412 13.147 7.12742 13.2566 7.24667 13.0601C7.21039 13.1359 7.17124 13.1499 7.11628 13.175C7.08827 13.2228 7.08144 13.3069 6.99416 13.3715C7.18669 13.4656 7.28044 13.3054 7.27361 13.3237C7.27361 13.3237 7.23553 13.3643 7.19638 13.3898C7.20895 13.6337 7.15974 14.3733 6.94782 14.5389C6.87778 14.6384 6.81456 14.6905 6.71507 14.79C6.38677 14.9667 6.19029 15.1689 5.90114 15.3273C5.84367 15.3553 5.7862 15.3833 5.72011 15.3553C5.65437 15.3359 5.58685 15.3456 5.53082 15.3934C5.46365 15.4509 5.3778 15.4591 5.29231 15.4509C5.13104 15.4311 4.9597 15.4128 4.78873 15.4214C4.66517 15.4311 4.57968 15.4789 4.51359 15.5841C4.4378 15.6976 4.45612 15.7454 4.58938 15.7734C4.75065 15.8115 4.91193 15.8115 5.07357 15.7835C5.2643 15.7357 5.45359 15.7637 5.62492 15.8395C5.7862 15.9167 5.93922 15.8873 6.0908 15.8014C6.23375 15.7159 6.38533 15.6599 6.53834 15.6121C6.67017 15.5744 6.80343 15.5644 6.91837 15.4789C6.94675 15.4606 6.97476 15.4606 6.99416 15.4986C7.05055 15.5924 7.11772 15.6782 7.12742 15.7932C7.14573 15.9925 7.1558 16.1915 7.18381 16.3909C7.19351 16.4864 7.16549 16.4961 7.08827 16.4864C6.83288 16.4584 6.57606 16.4006 6.3293 16.3531C6.26177 16.3431 6.23375 16.2968 6.21399 16.2393C6.19603 16.1736 6.15796 16.1157 6.0908 16.106C6.01501 16.0963 5.95753 16.1441 5.91946 16.2016C5.87169 16.2968 5.7862 16.3531 5.69209 16.4006C5.59691 16.4483 5.51106 16.5058 5.41587 16.5622C5.38786 16.5816 5.34009 16.5999 5.34978 16.638C5.35984 16.6955 5.41588 16.6955 5.46365 16.6955C5.64468 16.6955 5.83397 16.7052 6.00494 16.6757C6.17628 16.6477 6.3293 16.6674 6.48088 16.7332C6.75566 16.847 7.01248 16.99 7.2693 17.1329C7.46865 17.2468 7.60191 17.2087 7.71541 17.0097C7.75492 16.9422 7.78294 16.8664 7.8009 16.7906C7.84867 16.5916 7.87813 16.3909 7.87813 16.1818C7.87813 15.897 7.84867 15.5716 7.83897 15.2853C7.81239 15.1872 7.84867 15.1211 7.83035 14.9638C7.8009 14.7127 7.90615 14.4013 8.06634 14.254C8.22475 14.1096 8.21792 13.9987 8.16871 13.8162C8.14069 13.7066 8.21935 13.6452 8.20499 13.6168C8.11519 13.5874 8.09005 13.6086 8.04228 13.6143C8.17841 13.5425 8.358 13.6955 8.8562 13.6747C8.97976 13.6844 9.17624 13.6578 9.28005 13.61C9.35692 13.5719 9.5789 13.5694 9.65468 13.5497C9.82566 13.5216 9.81596 13.5313 9.81596 13.7012C9.79764 14.2623 9.7021 14.8137 9.5789 15.3654C9.38924 16.2296 9.12272 17.0755 9.02754 17.9695C9.00922 18.1965 9.01748 18.4253 9.02754 18.6527C9.05699 18.5108 9.06525 18.3678 9.0947 18.226C9.18019 17.7224 9.33177 17.2468 9.48335 16.7612C9.77789 15.8593 10.0922 14.9652 10.1877 14.0155C10.2438 13.5019 10.2254 12.98 10.0825 12.4847C9.87343 11.734 9.48335 11.0985 8.81813 10.6704C8.20104 10.2706 7.4981 10.1471 6.77541 10.119C5.94891 10.0813 5.13104 10.1948 4.33256 10.3662C3.97193 10.4419 3.52581 10.568 3.13573 10.6844V10.6844ZM9.284 8.38199C9.29945 8.69772 9.65612 8.873 9.91546 8.88593C10.5175 8.76524 10.5749 8.61761 11.1446 8.38054C10.7603 8.16754 10.8221 8.22071 10.6058 8.0932C10.2549 7.88379 10.1694 7.83638 9.75131 7.91217C9.56345 7.94844 9.27143 8.05943 9.20282 8.14923C9.16224 8.20096 9.3544 8.25304 9.50167 8.16468C9.61517 8.11116 9.64894 8.07631 9.84972 8.03536C10.1062 8.00052 10.178 8.07344 10.3113 8.197C10.4165 8.29219 10.3364 8.55189 10.1805 8.63738C10.0573 8.72286 9.75705 8.76919 9.62092 8.6151C9.41618 8.41288 9.36123 8.2728 9.284 8.38199V8.38199ZM9.44671 2.0358C8.35405 2.97185 7.75205 3.80662 7.36053 5.03433C7.09688 5.85939 6.83719 6.66757 6.83863 8.26418C6.0908 8.34823 5.46221 8.5562 4.83363 8.95741C4.24994 9.33205 3.57215 9.91573 3.11742 10.4574C3.55958 10.0713 4.15439 9.51846 4.68205 9.18872C5.33146 8.78463 6.02327 8.54075 7.08001 8.51812C7.16693 6.80766 7.13316 6.17368 7.44171 5.26313C7.88387 3.95388 8.61195 2.73047 9.44671 2.0358Z"
                    fill="black"
                  />
                  <path
                    d="M9.07351 13.3614C9.03579 13.3643 8.83787 13.3349 8.76783 13.3097C8.67803 13.2774 8.5771 13.2691 8.48012 13.2523C8.32028 13.2228 8.38601 13.2383 8.29909 13.189C8.1784 13.119 8.03832 13.0921 7.98336 13.1118C7.895 13.0921 7.91619 13.064 7.90218 12.9814C7.88243 12.8762 7.9539 12.7792 8.01999 12.7232C8.10548 12.6474 8.20103 12.5619 8.07747 12.4383C8.03975 12.3992 8.13494 12.3331 8.05771 12.3234C7.92445 12.3137 7.8404 12.1718 7.70714 12.1815C7.58358 12.1901 7.53581 12.1341 7.50635 12.0202C7.49522 11.9753 7.48409 11.8363 7.4532 11.7185C7.41799 11.577 7.36196 11.4534 7.34795 11.4003C7.2481 11.0199 7.23014 10.9667 7.08 10.6032C7.08 10.5946 7.06994 10.5849 7.06994 10.5752C7.04192 10.4613 7.06024 10.4319 7.1838 10.4516C7.74486 10.5371 8.27682 10.679 8.74269 11.0213C9.21826 11.3733 9.49304 11.8575 9.68413 12.3992C9.75992 12.6179 9.80733 12.8564 9.83571 13.0838C9.83966 13.1653 9.90575 13.29 9.77788 13.3097C9.53542 13.3532 9.26998 13.3334 9.07351 13.3614V13.3614Z"
                    fill="black"
                  />
                </svg>

                {date && (
                  <div className="date" {...contentEditable}>
                    {date}
                  </div>
                )}
                {setters && (
                  <div className="setters" {...contentEditable}>
                    {setters}
                  </div>
                )}
                {notes && (
                  <div className="notes" {...contentEditable}>
                    {notes}
                  </div>
                )}
              </div>
            </div>
            <div
              className="grades"
              style={{
                backgroundColor: gradeData.color,
              }}
            >
              <div className="grade" {...contentEditable}>
                {grade || '?'}
              </div>
              <dl>
                <dd>YDS</dd>
                <dt>{gradeData.yds}</dt>
                <dd>French</dd>
                <dt>{gradeData.french}</dt>
                <dd>UIAA</dd>
                <dt>{gradeData.uiaa}</dt>
              </dl>
            </div>
          </div>
        )
      }

      ReactDOM.render(render(), document.getElementById('sections'))
    </script>
    <style>
      * {
        margin: 0;
        padding: 0;
        font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS',
          sans-serif;
      }
      @media print {
        .name {
          /* Give a little extra space because the layout changes
          slightly in print which can cause it to overflow to 2 lines
          when it as originally sized for one */
          margin-left: 0 !important;
          /* some labels get weirdly tall in print, don't */
          max-height: 13vw;
        }
      }
      .climb {
        display: flex;
        border: 3px solid black;
        border-left: none;
        margin: 1vw;
        margin-bottom: 3vw;
        padding-left: 20vw;
      }
      .details {
        display: flex;
        flex: 1;
        width: 1px;
        flex-direction: column;
        justify-content: space-between;
        align-items: flex-end;
      }
      .name {
        display: flex;
        flex: 1;
        align-items: center;
        line-height: 1;
        margin: 1vw;
        margin-right: 3vw;
        overflow: visible;
        text-align: right;
      }
      .meta {
        display: flex;
        align-items: flex-end;
        font-size: 3vw;
        margin: 1vw;
        margin-right: 3vw;
        text-align: right;
      }
      .meta svg {
        height: 6vw;
      }
      .meta > * + * {
        margin-left: 3vw;
      }
      .date {
        white-space: nowrap;
      }
      /* .setters {
        margin-left: 3vw;
      }
      .notes {
        margin-left: 3vw;
      } */
      .grades {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        width: 22vw;
      }
      .grade {
        display: flex;
        height: 14vw;
        min-width: 14vw;
        margin: 2vw;
        justify-content: center;
        align-items: center;
        font-size: 14vw;
      }
      dl {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        grid-template-rows: auto auto;
        grid-column-gap: 3vw;
        margin-left: 2vw;
        margin-right: 2vw;
        margin-bottom: 1vw;
      }
      dd {
        font-size: 1.2vw;
      }
      dt {
        grid-row-start: 2;
        font-size: 2.2vw;
      }
      @media print {
        .climb {
          page-break-inside: avoid;
        }
      }
    </style>
  </body>
</html>
